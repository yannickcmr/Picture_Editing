<html>
  <head>
    <meta charset="UTF-8">
    <title>Webtechnologien WS 22/23 Hausaufgabe 3.1</title>
    <style>
      html {
        font-family: Verdana, Geneva, Tahoma, sans-serif;
      }

      .header {
        width: 80%;
        margin: 0 auto;
      }

      h3 {
        margin-bottom: 0px;
      }

      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
      }

      table {
        table-layout : fixed;
      }

      div {
        margin-bottom: 20px;
      }

      td {
        padding: 8px;
        word-wrap: break-word
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Webtechnologien WS 22/23 Hausaufgabe 3.1</h1>
      <p>
        In dieser Aufgabe beschäftigen wir uns mit Funktionen höherer Ordnung und Lambda-Ausdrücken. Hierzu wollen wir zwei Datensätze verarbeiten, die eine Studierenden- und Prüfungsverwaltung nachbilden. Sie finden diese Datensätze in der Vorlage unter <code>ha03/js/db/</code>.
      </p>
      <p>
        Leider sind diese Datensätze nicht frei von Fehlern und Unschlüssigkeiten. So gibt es zum einen mehrere Studierende mit identischen Matrikelnummern, zum anderen gibt es Studierende, die mehrere Noten in ein und dem selben Kurs haben. Es gibt aber auch ganz banale Hürden zu überwinden, wie die Verwendung von Kommas als Dezimaltrennzeichen. Ihre Aufgabe ist es im Folgenden, einen Überblick über die Daten zu schaffen und die zuvor genannten fehlerhaften Einträge zu identifizieren.
      </p>
      <p>
        In dieser Aufgabe sollen Sie über Arrays iterieren, indem Sie <code>map()</code>, <code>filter()</code> und <code>reduce()</code> verwenden. Implementieren Sie <b>keine for-Schleifen</b>. Bearbeiten Sie für diese Aufgabe ausschließlich die Datei <code>index.js</code>!
      </p>
      <p>
        Ihnen sind zusätzlich in der Vorgabe für jede Teilaufgabe die vollständigen resultierenden Arrays in der geforderten Sortierung als JSON gegeben, damit Sie Ihre Lösung abgleichen können. Sie finden diese Arrays jeweils in den Dateien <code>js-a0x-result.json</code>.
      </p>
    </div>
    
    <!-- Aufgabe 3.1.1 -->
    <div>
      <table width="80%" style="margin: 0 auto;">
        <tbody id="a01">
          <tr><td colspan="3"><h3>3.1.1: notGoodGrades (1 Punkt)</h3></td></tr>
          <tr>
            <td colspan="3">
              <p>Betrachten Sie die Datei <code>index.js</code></p>
              <p>
                Implementieren Sie die Funktion <code>notGoodGrades()</code>, welche die Variable <code>grades</code>
                als Array (siehe <code>db/grades.js</code>) übergeben bekommt und nach allen Noten filtert, die 
                3,0 oder schlechter sind. (1 Punkt)
              </p>
              <p>
                <b>Hinweis:</b> Beachten Sie, dass im Datensatz die Noten als String repräsentiert sind. Außerdem wurde 
                das Komma als Dezimaltrennzeichen verwendet. 
              </p>
            </td>
          </tr>
          <tr><td><b>command</b></td><td><b>expected</b></td><td><b>output</b></td></tr>
        </tbody>
      </table>
    </div>

    <!-- Aufgabe 3.1.2 -->
    <div>
      <table width="80%" style="margin: 0 auto;">
        <tbody id="a02">
          <tr><td colspan="3"><h3>3.1.2: gradeOverview (1 Punkt)</h3></td></tr>
          <tr>
            <td colspan="3">
              <p>Betrachten Sie die Datei <code>index.js</code></p>
              <p>
                Implementieren Sie die Funktion <code>gradeOverview()</code>, welche die Variablen <code>students</code>
                und <code>grades</code> übergeben bekommt und für jede*n Studierende*n eine Notenübersicht erstellt.
                Dabei soll jedes Element im <code>students</code>-Array auf ein Objekt im folgenden Format projiziert
                werden: <code>{ student: (students[i]), grades: [(grades[j], grades[j+k], ...)] }</code>.
              </p>
            </td>
          </tr>
          <tr><td><b>command</b></td><td><b>expected</b></td><td><b>output</b></td></tr>
        </tbody>
      </table>
    </div>
    
    <!-- Aufgabe 3.1.3 -->
    <div>
      <table width="80%" style="margin: 0 auto;">
        <tbody id="a03">
          <tr><td colspan="3"><h3>3.1.3: duplicateStudents (2 Punkte)</h3></td></tr>
          <tr>
            <td colspan="3">
              <p>Betrachten Sie die Datei <code>index.js</code></p>
              <p>
                Implementieren Sie die Funktion <code>duplicateStudents()</code>, welche die Variable <code>students</code>
                übergeben bekommt und nach Studierenden mit der selben Matrikelnummer filtert.
              </p>
              <p>
                <b>Tipp:</b> Projizieren Sie zuerst alle Elemente in <code>students</code> nach <code>matrikelnummer</code>.
                Danach können Sie relativ einfach nach Duplikaten filtern. Projizieren Sie zuletzt nach folgendem Format:
                <code>{ matrikelnummer: (matrikelnummer), students: [(students[i], students[j], ...)] }</code>.
              </p>
              <p style="color: red; font-weight: bold;">
                <u>Hinweis:</u> Sie sollen nach Duplikaten im Array <code>students</code> filtern. 
                Das schließt nicht aus, dass es Duplikate im resultierenden Array gibt.
                Duplikate im resultierenden Array sollen nicht betrachtet werden, d.h. sie werden ebenfalls ins Zielformat projiziert.
              </p>
            </td>
          </tr>
          <tr><td><b>command</b></td><td><b>expected</b></td><td><b>output</b></td></tr>
        </tbody>
      </table>
    </div>

    <!-- Aufgabe 3.1.4 -->
    <div>
      <table width="80%" style="margin: 0 auto;">
        <tbody id="a04">
          <tr><td colspan="3"><h3>3.1.4: invalidGrades (4 Punkte)</h3></td></tr>
          <tr>
            <td colspan="3">
              <p>Betrachten Sie die Datei <code>index.js</code></p>
              <p>
                Implementieren Sie die Funktion <code>invalidGrades()</code>, welche die Variable <code>grades</code>
                übergeben bekommt und nach wohlmöglich fehlerhaften Noten filtert. Um z.B. eine manuelle Überprüfung
                so gering wie möglich zu halten, soll die Funktion ermitteln für welche Matrikelnummern mehrere Noten
                für den gleichen Kurs übermittelt wurden. 
              </p>
              <p>
                <b>Beispiel:</b> Für Matrikelnummer X wurde für Kurs Y einmal eine 2,7 und einmal eine 2,3 übermittelt.
                Die Funktion würde aber auch den validen Fall berücksichtigen, also: Für Matrikelnummer X wurde für Kurs Y
                einmal eine 5,0 und einmal eine 2,3 übermittelt.
              </p>
              <p>
                <b>Tipp:</b> Beachten Sie ganz genau die Vorgabe hierzu.
              </p>
            </td>
          </tr>
          <tr><td><b>command</b></td><td><b>expected</b></td><td><b>output</b></td></tr>
        </tbody>
      </table>
    </div>

    <!-- scripts -->
    <script src="db/students.js"></script>
    <script src="db/grades.js"></script>
    <script src="index.js"></script>
    <script src="data.js"></script>
    <script>
      data
        .map((e) => {
          let expected = (typeof e.expected === "object") ? output(e.expected) : e.expected;
          e["html"] = 
            "<tr>" +
              "<td>" + e.cmd + "</td>" +
              "<td>" + expected + "</td>" + 
              "<td id='" + e.id + "'></td>" + 
            "</tr>";
          return e;
        })
        .forEach((e) => {
          let result = [];
          try {
            result = eval(e.cmd);
          } catch (err) {
            console.error(err);
          }
          
          document.getElementById(e.id.split("-")[0]).innerHTML += e.html;
          let cell = document.getElementById(e.id);
          cell.innerHTML = output(result);
          let expected = (typeof e.expected === "object") ? output(e.expected) : e.expected;
          if (output(result) == expected) {
            cell.style.background = "lightgreen";
          } else {
            cell.style.background = "lightcoral";
          }
        })

      function output(string) {
        return JSON.stringify(string).replaceAll(",", ", ")
      }

      function order(array, type) {
        switch (type) {
          case 0:
            return array.sort((a, b) => a.id - b.id);
          case 1:
            return array
              .map((e) => {
                e.grades.sort((a, b) => a.id - b.id);
                return e;
              })
              .sort((a, b) => a.matrikelnummer - b.matrikelnummer);
          case 2:
            return array
              .map((e) => {
                e.students.sort((a, b) => a.nachname.localeCompare(b.nachname));
                return e;
              })
              .sort((a, b) => a.matrikelnummer - b.matrikelnummer);
          case 3:
            return array
              .map((e) => {
                e.grades.map((j) => j.sort((a, b) => a.id - b.id));
                return e;
              })
              .sort((a, b) => a.matrikelnummer - b.matrikelnummer);              
        }
      }       
    </script>
  </body>
</html>